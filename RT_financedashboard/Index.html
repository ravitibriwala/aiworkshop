<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Coffee Shop Manager — Live Orders Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* Smooth scrollbar for alert panel */
    .nice-scroll { scrollbar-width: thin; }
    .nice-scroll::-webkit-scrollbar { width: 8px; }
    .nice-scroll::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 9999px; }
  </style>
</head>
<body class="bg-slate-50 text-slate-800">
  <!-- Header / Controls -->
  <header class="sticky top-0 z-50 backdrop-blur bg-white/80 border-b border-slate-200">
    <div class="max-w-7xl mx-auto px-4 py-4 flex flex-col gap-3 md:flex-row md:items-center md:justify-between">
      <div class="flex items-center gap-3">
        <div class="h-10 w-10 rounded-2xl bg-amber-500/10 grid place-content-center text-amber-600">☕</div>
        <h1 class="text-xl md:text-2xl font-bold">Live Orders Dashboard</h1>
        <span id="clock" class="ml-2 text-sm text-slate-500"></span>
      </div>
      <div class="flex flex-wrap items-center gap-2">
        <button id="addDemoBtn" class="px-3 py-2 rounded-xl bg-emerald-600 text-white hover:bg-emerald-700 transition">Add Demo Order</button>
        <button id="seedBtn" class="px-3 py-2 rounded-xl bg-emerald-50 text-emerald-700 hover:bg-emerald-100 border border-emerald-200 transition">Add 5 Demo Orders</button>
        <div class="flex items-center gap-2 bg-white border border-slate-200 rounded-xl px-3 py-2">
          <label for="autoRefresh" class="text-sm text-slate-600">Auto‑refresh</label>
          <select id="autoRefresh" class="bg-transparent focus:outline-none">
            <option value="0">Off</option>
            <option value="5">Every 5s</option>
            <option value="10">Every 10s</option>
            <option value="30">Every 30s</option>
            <option value="60">Every 60s</option>
          </select>
          <button id="refreshNow" class="ml-1 text-sm px-2 py-1 rounded-lg bg-slate-100 hover:bg-slate-200">Refresh now</button>
        </div>
        <div class="flex items-center gap-2 bg-white border border-slate-200 rounded-xl px-3 py-2">
          <label for="filterStatus" class="text-sm text-slate-600">Filter</label>
          <select id="filterStatus" class="bg-transparent focus:outline-none">
            <option value="all">All</option>
            <option value="waiting">Waiting</option>
            <option value="in_progress">In Progress</option>
            <option value="ready">Ready</option>
            <option value="cancelled">Cancelled</option>
          </select>
        </div>
      </div>
    </div>
  </header>

  <!-- Summary Bar -->
  <section class="max-w-7xl mx-auto px-4 mt-6 grid gap-3 md:grid-cols-3">
    <div class="rounded-2xl bg-white border border-slate-200 p-4 shadow-sm">
      <div class="text-sm text-slate-500">Total Orders (Today)</div>
      <div id="totalOrders" class="text-2xl font-semibold mt-1">0</div>
      <div id="lastUpdated" class="text-xs text-slate-400 mt-1">—</div>
    </div>
    <div class="rounded-2xl bg-white border border-slate-200 p-4 shadow-sm">
      <div class="text-sm text-slate-500">Ready vs Pending</div>
      <div class="flex items-end gap-4 mt-1">
        <div class="text-2xl"><span id="readyCount" class="font-semibold">0</span> <span class="text-sm text-slate-500">ready</span></div>
        <div class="text-2xl"><span id="pendingCount" class="font-semibold">0</span> <span class="text-sm text-slate-500">pending</span></div>
      </div>
      <div class="w-full bg-slate-100 rounded-full h-2 mt-2 overflow-hidden">
        <div id="readyBar" class="h-2 bg-emerald-500" style="width:0%"></div>
      </div>
    </div>
    <div class="rounded-2xl bg-white border border-slate-200 p-4 shadow-sm">
      <div class="text-sm text-slate-500">Total Revenue (Today)</div>
      <div id="totalRevenue" class="text-2xl font-semibold mt-1">$0.00</div>
      <div id="revenueNote" class="text-xs text-slate-400 mt-1">Excludes cancelled orders</div>
    </div>
  </section>

  <!-- Revenue by Category -->
  <section class="max-w-7xl mx-auto px-4 mt-3">
    <div class="rounded-2xl bg-white border border-slate-200 p-4 shadow-sm">
      <div class="flex items-center justify-between">
        <h2 class="font-semibold">Revenue by Category</h2>
        <span id="categoryTotal" class="text-sm text-slate-500">$0.00</span>
      </div>
      <div id="categoryBar" class="w-full bg-slate-100 rounded-full h-3 mt-3 overflow-hidden flex"></div>
      <div id="categoryBreakdown" class="grid gap-3 mt-4 sm:grid-cols-2 md:grid-cols-3"></div>
    </div>
  </section>

  <!-- Payment Method Comparison -->
  <section class="max-w-7xl mx-auto px-4 mt-3">
    <div class="rounded-2xl bg-white border border-slate-200 p-4 shadow-sm">
      <div class="flex items-center justify-between">
        <h2 class="font-semibold">Cash vs Card Sales</h2>
        <span id="paymentTotal" class="text-sm text-slate-500">$0.00</span>
      </div>
      <div id="paymentBar" class="w-full bg-slate-100 rounded-full h-3 mt-3 overflow-hidden flex"></div>
      <div id="paymentBreakdown" class="grid gap-3 mt-4 sm:grid-cols-2 md:grid-cols-3"></div>
    </div>
  </section>

  <!-- Cancelled Orders Summary -->
  <section class="max-w-7xl mx-auto px-4 mt-3">
    <div class="rounded-2xl bg-white border border-slate-200 p-4 shadow-sm">
      <div class="flex items-center justify-between">
        <h2 class="font-semibold">Cancelled Orders Summary</h2>
        <span id="cancelledCount" class="text-sm text-slate-500">0</span>
      </div>
      <div id="cancelledSummary" class="mt-3 space-y-2 text-sm text-slate-700"></div>
    </div>
  </section>

  <!-- Content: Alerts + Orders Grid -->
  <main class="max-w-7xl mx-auto px-4 mt-6 grid gap-6 lg:grid-cols-12">
    <!-- Alerts Panel -->
    <aside class="lg:col-span-4 xl:col-span-3 space-y-4">
      <div class="rounded-2xl bg-white border border-slate-200 p-4 shadow-sm">
        <div class="flex items-center justify-between">
          <h2 class="font-semibold">Alerts</h2>
          <span id="alertCount" class="text-xs text-slate-500">0</span>
        </div>
        <div id="alerts" class="mt-3 space-y-2 max-h-80 overflow-y-auto nice-scroll"></div>
      </div>

      <!-- Smart Assistant -->
      <div class="rounded-2xl bg-white border border-slate-200 p-4 shadow-sm">
        <div class="flex items-center justify-between">
          <h2 class="font-semibold">Smart Assistant</h2>
          <button id="assistantRefresh" class="text-xs px-2 py-1 rounded-lg bg-slate-100 hover:bg-slate-200">Update</button>
        </div>
        <ul id="assistantTips" class="mt-3 list-disc pl-5 space-y-2 text-sm text-slate-700"></ul>
      </div>
    </aside>

    <!-- Orders Grid -->
    <section class="lg:col-span-8 xl:col-span-9">
      <div id="ordersGrid" class="grid gap-4 sm:grid-cols-2 xl:grid-cols-3"></div>
    </section>
  </main>

  <!-- Templates (hidden) -->
  <template id="orderCardTemplate">
    <div class="order-card rounded-2xl bg-white border border-slate-200 p-4 shadow-sm flex flex-col gap-3">
      <div class="flex items-start justify-between gap-3">
        <div>
          <div class="flex items-center gap-2">
            <h3 class="font-semibold text-lg customer"></h3>
            <span class="status-badge text-xs px-2 py-1 rounded-full"></span>
          </div>
          <div class="text-xs text-slate-500 timestamp">–</div>
        </div>
        <div class="text-right">
          <div class="payment inline-flex items-center gap-1 text-xs px-2 py-1 rounded-full bg-slate-100"></div>
          <div class="text-sm font-semibold total mt-1"></div>
        </div>
      </div>

      <ul class="items list-disc pl-5 text-sm text-slate-700"></ul>

      <div class="flex items-center gap-2 mt-auto">
        <select class="statusSelect bg-white border border-slate-200 rounded-lg px-2 py-1 text-sm">
          <option value="waiting">Set: Waiting</option>
          <option value="in_progress">Set: In Progress</option>
          <option value="ready">Set: Ready</option>
        </select>
        <button class="markNext px-3 py-2 rounded-lg bg-slate-100 hover:bg-slate-200 text-sm">Next step</button>
        <button class="cancel px-3 py-2 rounded-lg bg-rose-100 hover:bg-rose-200 text-rose-700 text-sm">Cancel</button>
      </div>
    </div>
  </template>

  <script>
    /***********************\n     * Data & Utilities    *
     ***********************/
    const fmt = new Intl.NumberFormat(undefined, { style: 'currency', currency: 'USD' });

    const MENU = {
      drinks: [
        { name: 'Espresso', price: 3.0 },
        { name: 'Americano', price: 3.5 },
        { name: 'Latte', price: 4.25 },
        { name: 'Cappuccino', price: 4.25 },
        { name: 'Mocha', price: 4.75 },
        { name: 'Cold Brew', price: 4.0 },
        { name: 'Flat White', price: 4.25 },
        { name: 'Matcha Latte', price: 4.5 },
      ],
      pastries: [
        { name: 'Croissant', price: 3.25 },
        { name: 'Almond Croissant', price: 3.75 },
        { name: 'Chocolate Muffin', price: 2.75 },
        { name: 'Blueberry Scone', price: 3.0 },
        { name: 'Cinnamon Roll', price: 3.5 },
      ],
      snacks: [
        { name: 'Granola Bar', price: 2.0 },
        { name: 'Yogurt Parfait', price: 3.25 },
        { name: 'Fruit Cup', price: 2.5 },
        { name: 'Bagel & Cream Cheese', price: 3.0 },
      ],
    };

    const NAMES = ['Alex','Sam','Taylor','Jordan','Riley','Casey','Morgan','Jamie','Harper','Quinn','Avery','Rowan','Charlie','Elliot','Reese'];
    const PAYMENTS = ['Card', 'Cash', 'App'];

    const STATUS = {
      WAITING: 'waiting',
      IN_PROGRESS: 'in_progress',
      READY: 'ready',
      CANCELLED: 'cancelled',
    };

    let orders = [];
    let autoTimer = null;

    function uid() { return Math.random().toString(36).slice(2, 9); }
    function pick(arr) { return arr[Math.floor(Math.random()*arr.length)]; }

    function relativeTime(ts) {
      const diff = Date.now() - ts;
      const mins = Math.floor(diff/60000);
      if (mins < 1) return 'just now';
      if (mins < 60) return `${mins}m ago`;
      const hrs = Math.floor(mins/60);
      return `${hrs}h ${mins%60}m ago`;
    }

    function calcTotal(items) { return items.reduce((s, it) => s + it.price, 0); }

    function demoOrder() {
      const items = [];
      const groups = ['drinks','pastries','snacks'];
      const lines = Math.ceil(Math.random()*3) + Math.floor(Math.random()*3); // 1-6 items
      for (let i=0; i<lines; i++) {
        const g = pick(groups);
        const m = pick(MENU[g]);
        items.push({ ...m, category: g });
      }
      return {
        id: uid(),
        customer: pick(NAMES) + ' ' + String.fromCharCode(65+Math.floor(Math.random()*26)) + '.',
        items,
        status: STATUS.WAITING,
        payment: pick(PAYMENTS),
        createdAt: Date.now(),
        updatedAt: Date.now(),
        total: calcTotal(items),
      };
    }

    /***********************\n     * Rendering           *
     ***********************/
    const els = {
      grid: document.getElementById('ordersGrid'),
      totalOrders: document.getElementById('totalOrders'),
      readyCount: document.getElementById('readyCount'),
      pendingCount: document.getElementById('pendingCount'),
      totalRevenue: document.getElementById('totalRevenue'),
      readyBar: document.getElementById('readyBar'),
      lastUpdated: document.getElementById('lastUpdated'),
      alerts: document.getElementById('alerts'),
      alertCount: document.getElementById('alertCount'),
      assistantTips: document.getElementById('assistantTips'),
      clock: document.getElementById('clock'),
      categoryBar: document.getElementById('categoryBar'),
      categoryBreakdown: document.getElementById('categoryBreakdown'),
      categoryTotal: document.getElementById('categoryTotal'),
      paymentBar: document.getElementById('paymentBar'),
      paymentBreakdown: document.getElementById('paymentBreakdown'),
      paymentTotal: document.getElementById('paymentTotal'),
      cancelledCount: document.getElementById('cancelledCount'),
      cancelledSummary: document.getElementById('cancelledSummary'),
    };

    // ===== Category Revenue Helpers =====
    function inferCategory(name) {
      if (MENU.drinks.some(x=>x.name===name)) return 'drinks';
      if (MENU.pastries.some(x=>x.name===name)) return 'pastries';
      return 'snacks';
    }

    function categoryStats() {
      const stats = { drinks:{revenue:0,count:0}, pastries:{revenue:0,count:0}, snacks:{revenue:0,count:0} };
      for (const o of orders) {
        if (o.status === STATUS.CANCELLED) continue;
        for (const it of o.items) {
          const cat = it.category || inferCategory(it.name);
          if (!stats[cat]) continue;
          stats[cat].revenue += it.price;
          stats[cat].count += 1;
        }
      }
      return stats;
    }

    function renderCategoryRevenue() {
      const s = categoryStats();
      const total = s.drinks.revenue + s.pastries.revenue + s.snacks.revenue;
      els.categoryTotal.textContent = fmt.format(total);
      els.categoryBar.innerHTML = '';
      const segs = [
        { key:'drinks', label:'Drinks', cls:'bg-amber-400' },
        { key:'pastries', label:'Pastries', cls:'bg-rose-400' },
        { key:'snacks', label:'Snacks', cls:'bg-sky-400' },
      ];
      for (const seg of segs) {
        const width = total ? Math.round(100 * (s[seg.key].revenue / total)) : 0;
        const d = document.createElement('div');
        d.className = seg.cls + ' h-3';
        d.style.width = width + '%';
        d.title = `${seg.label}: ${fmt.format(s[seg.key].revenue)} (${width}%)`;
        els.categoryBar.appendChild(d);
      }
      els.categoryBreakdown.innerHTML = '';
      for (const seg of segs) {
        const pct = total ? Math.round(100 * (s[seg.key].revenue / total)) : 0;
        const card = document.createElement('div');
        card.className = 'rounded-xl border border-slate-200 p-3';
        const pillBg = seg.cls.replace('400','100');
        const pillText = seg.cls.replace('bg-','text-').replace('400','700');
        card.innerHTML = `
          <div class="flex items-center justify-between">
            <div class="font-medium">${seg.label}</div>
            <span class="text-xs px-2 py-0.5 rounded-full ${pillBg} ${pillText}">${pct}%</span>
          </div>
          <div class="text-2xl font-semibold mt-1">${fmt.format(s[seg.key].revenue)}</div>
          <div class="text-xs text-slate-500">Items sold: ${s[seg.key].count}</div>
        `;
        els.categoryBreakdown.appendChild(card);
      }
    }

    function renderPaymentComparison() {
      const stats = { Card:{revenue:0,count:0}, Cash:{revenue:0,count:0}, App:{revenue:0,count:0} };
      for (const o of orders) {
        if (o.status === STATUS.CANCELLED) continue;
        stats[o.payment].revenue += o.total;
        stats[o.payment].count += 1;
      }
      const total = stats.Card.revenue + stats.Cash.revenue + stats.App.revenue;
      els.paymentTotal.textContent = fmt.format(total);
      els.paymentBar.innerHTML = '';
      const segs = [
        { key:'Card', label:'Card', cls:'bg-blue-400' },
        { key:'Cash', label:'Cash', cls:'bg-amber-400' },
        { key:'App', label:'App', cls:'bg-emerald-400' },
      ];
      for (const seg of segs) {
        const width = total ? Math.round(100 * (stats[seg.key].revenue / total)) : 0;
        const d = document.createElement('div');
        d.className = seg.cls + ' h-3';
        d.style.width = width + '%';
        d.title = `${seg.label}: ${fmt.format(stats[seg.key].revenue)} (${width}%)`;
        els.paymentBar.appendChild(d);
      }
      els.paymentBreakdown.innerHTML = '';
      for (const seg of segs) {
        const pct = total ? Math.round(100 * (stats[seg.key].revenue / total)) : 0;
        const card = document.createElement('div');
        card.className = 'rounded-xl border border-slate-200 p-3';
        const pillBg = seg.cls.replace('400','100');
        const pillText = seg.cls.replace('bg-','text-').replace('400','700');
        card.innerHTML = `
          <div class="flex items-center justify-between">
            <div class="font-medium">${seg.label}</div>
            <span class="text-xs px-2 py-0.5 rounded-full ${pillBg} ${pillText}">${pct}%</span>
          </div>
          <div class="text-2xl font-semibold mt-1">${fmt.format(stats[seg.key].revenue)}</div>
          <div class="text-xs text-slate-500">Orders: ${stats[seg.key].count}</div>
        `;
        els.paymentBreakdown.appendChild(card);
      }
    }

    function renderCancelledSummary() {
      const cancelled = orders.filter(o=>o.status===STATUS.CANCELLED);
      els.cancelledCount.textContent = cancelled.length;
      els.cancelledSummary.innerHTML = '';
      if (!cancelled.length) {
        els.cancelledSummary.innerHTML = '<div class="text-slate-500">No cancelled orders.</div>';
        return;
      }
      for (const o of cancelled) {
        const div = document.createElement('div');
        div.className = 'border border-rose-200 bg-rose-50 rounded-xl p-2';
        div.innerHTML = `<div class="font-medium">${o.customer}</div>
          <div class="text-xs text-slate-500">${new Date(o.createdAt).toLocaleTimeString()} • ${relativeTime(o.createdAt)}</div>
          <div class="text-xs text-slate-600">${o.items.length} item(s), ${o.payment}, ${fmt.format(o.total)}</div>`;
        els.cancelledSummary.appendChild(div);
      }
    }

    function setStatusBadge(el, status) {
      const map = {
        [STATUS.WAITING]: { text: 'Waiting', cls: 'bg-amber-100 text-amber-700' },
        [STATUS.IN_PROGRESS]: { text: 'In Progress', cls: 'bg-blue-100 text-blue-700' },
        [STATUS.READY]: { text: 'Ready', cls: 'bg-emerald-100 text-emerald-700' },
        [STATUS.CANCELLED]: { text: 'Cancelled', cls: 'bg-rose-100 text-rose-700 line-through' },
      };
      const s = map[status] || map[STATUS.WAITING];
      el.className = 'status-badge text-xs px-2 py-1 rounded-full ' + s.cls;
      el.textContent = s.text;
    }

    function renderOrders() {
      const filter = document.getElementById('filterStatus').value;
      els.grid.innerHTML = '';
      const template = document.getElementById('orderCardTemplate');

      let visible = orders
        .slice()
        .sort((a,b) => b.createdAt - a.createdAt)
        .filter(o => filter==='all' ? true : o.status === filter);

      for (const o of visible) {
        const frag = template.content.cloneNode(true);
        frag.querySelector('.customer').textContent = o.customer;
        frag.querySelector('.timestamp').textContent = `${new Date(o.createdAt).toLocaleTimeString()} • ${relativeTime(o.createdAt)}`;
        const statusEl = frag.querySelector('.status-badge');
        setStatusBadge(statusEl, o.status);

        const paymentEl = frag.querySelector('.payment');
        paymentEl.textContent = o.payment;
        paymentEl.classList.toggle('bg-slate-100', true);

        frag.querySelector('.total').textContent = fmt.format(o.total);

        const ul = frag.querySelector('.items');
        o.items.forEach(it => {
          const li = document.createElement('li');
          li.textContent = `${it.name} — ${fmt.format(it.price)}`;
          ul.appendChild(li);
        });

        const sel = frag.querySelector('.statusSelect');
        sel.value = o.status===STATUS.CANCELLED ? STATUS.WAITING : o.status;
        sel.addEventListener('change', () => updateOrderStatus(o.id, sel.value));

        frag.querySelector('.markNext').addEventListener('click', () => nextStep(o.id));
        const cancelBtn = frag.querySelector('.cancel');
        cancelBtn.addEventListener('click', () => cancelOrder(o.id));
        if (o.status===STATUS.CANCELLED) cancelBtn.disabled = true;

        els.grid.appendChild(frag);
      }

      renderSummary();
      renderAlerts();
      renderAssistant();
      renderCategoryRevenue();
      renderPaymentComparison();
      els.lastUpdated.textContent = 'Updated ' + new Date().toLocaleTimeString();
      renderCancelledSummary();
    }

    function renderSummary() {
      const total = orders.length;
      const ready = orders.filter(o => o.status === STATUS.READY).length;
      const pending = orders.filter(o => o.status === STATUS.WAITING || o.status === STATUS.IN_PROGRESS).length;
      const revenue = orders.filter(o => o.status !== STATUS.CANCELLED).reduce((s,o)=> s + o.total, 0);

      els.totalOrders.textContent = total;
      els.readyCount.textContent = ready;
      els.pendingCount.textContent = pending;
      els.totalRevenue.textContent = fmt.format(revenue);

      const pct = total ? Math.round(100*ready/total) : 0;
      els.readyBar.style.width = pct + '%';
    }

    function renderAlerts() {
      const alerts = [];
      const now = Date.now();
      const longWait = orders.filter(o => (o.status===STATUS.WAITING || o.status===STATUS.IN_PROGRESS) && (now - o.createdAt) > 10*60*1000);
      const largeOrders = orders.filter(o => o.items.length >= 6 && o.status !== STATUS.CANCELLED);
      const cancelled = orders.filter(o => o.status === STATUS.CANCELLED);

      if (longWait.length) alerts.push({ type:'warning', text:`${longWait.length} long-waiting order(s) > 10m.`});
      if (largeOrders.length) alerts.push({ type:'info', text:`${largeOrders.length} large group order(s) (6+ items).`});
      if (cancelled.length) alerts.push({ type:'error', text:`${cancelled.length} order(s) cancelled.`});

      els.alerts.innerHTML = '';
      if (!alerts.length) {
        const ok = document.createElement('div');
        ok.className = 'text-sm text-slate-500';
        ok.textContent = 'No alerts.';
        els.alerts.appendChild(ok);
      } else {
        for (const a of alerts) {
          const div = document.createElement('div');
          const styles = {
            warning: 'bg-amber-50 text-amber-700 border-amber-200',
            info: 'bg-blue-50 text-blue-700 border-blue-200',
            error: 'bg-rose-50 text-rose-700 border-rose-200',
          }[a.type] || 'bg-slate-50 text-slate-700 border-slate-200';
          div.className = `border rounded-xl px-3 py-2 text-sm ${styles}`;
          div.textContent = a.text;
          els.alerts.appendChild(div);
        }
      }
      els.alertCount.textContent = alerts.length;
    }

    function topQueuedItems() {
      const queue = orders.filter(o => o.status===STATUS.WAITING || o.status===STATUS.IN_PROGRESS);
      const map = new Map();
      for (const o of queue) for (const it of o.items) {
        map.set(it.name, (map.get(it.name)||0)+1);
      }
      return [...map.entries()].sort((a,b)=>b[1]-a[1]);
    }

    function renderAssistant() {
      const tips = [];
      const queued = orders.filter(o => o.status===STATUS.WAITING || o.status===STATUS.IN_PROGRESS);
      const longWaitCount = orders.filter(o => (o.status===STATUS.WAITING || o.status===STATUS.IN_PROGRESS) && (Date.now()-o.createdAt)>10*60*1000).length;
      const inProg = orders.filter(o => o.status===STATUS.IN_PROGRESS).length;
      const ready = orders.filter(o => o.status===STATUS.READY).length;
      const cancelled = orders.filter(o => o.status===STATUS.CANCELLED).length;

      const ranked = topQueuedItems();
      if (ranked.length && ranked[0][1] >= 5) {
        tips.push(`Consider prepping more ${ranked[0][0]} — ${ranked[0][1]} queued.`);
      }
      if (inProg >= ready + 5) {
        tips.push('Bottleneck: Many drinks in progress vs ready. Rebalance bar & handoff.');
      }
      if (longWaitCount >= 3) {
        tips.push('Prioritize oldest tickets — several orders waiting > 10 minutes.');
      }
      const cashRatio = orders.length ? (orders.filter(o=>o.payment==='Cash').length / orders.length) : 0;
      if (cashRatio > 0.6) {
        tips.push('High cash ratio — ensure change drawer is stocked to speed checkout.');
      }
      if (cancelled >= 3) {
        tips.push('Spike in cancellations — check queue estimates and inventory.');
      }
      if (!tips.length) tips.push('All clear. Keep the cadence steady and maintain prep for popular items.');

      els.assistantTips.innerHTML = '';
      for (const t of tips) {
        const li = document.createElement('li');
        li.textContent = t;
        els.assistantTips.appendChild(li);
      }
    }

    /***********************\n     * State Updates       *
     ***********************/
    function updateOrderStatus(id, status) {
      const o = orders.find(x => x.id === id);
      if (!o) return;
      o.status = status;
      o.updatedAt = Date.now();
      renderOrders();
    }

    function nextStep(id) {
      const o = orders.find(x => x.id === id);
      if (!o) return;
      if (o.status === STATUS.WAITING) o.status = STATUS.IN_PROGRESS;
      else if (o.status === STATUS.IN_PROGRESS) o.status = STATUS.READY;
      o.updatedAt = Date.now();
      renderOrders();
    }

    function cancelOrder(id) {
      const o = orders.find(x => x.id === id);
      if (!o || o.status===STATUS.CANCELLED) return;
      o.status = STATUS.CANCELLED;
      o.updatedAt = Date.now();
      renderOrders();
    }

    function autoProgressTick() {
      // Heuristic progression:
      // - Some waiting -> in_progress
      // - Some in_progress -> ready (faster if older)
      const now = Date.now();
      const waiting = orders.filter(o => o.status===STATUS.WAITING);
      const inProg = orders.filter(o => o.status===STATUS.IN_PROGRESS);

      // Move 0-30% of waiting to in_progress
      const moveW = Math.floor(Math.random()*Math.ceil(waiting.length*0.3));
      for (let i=0; i<moveW; i++) {
        const o = waiting[i];
        if (!o) break;
        o.status = STATUS.IN_PROGRESS;
        o.updatedAt = now;
      }

      // Complete in-progress based on age
      for (const o of inProg) {
        const ageMin = (now - o.updatedAt)/60000;
        const p = Math.min(0.1 + ageMin*0.05, 0.9); // older -> higher chance
        if (Math.random() < p) {
          o.status = STATUS.READY;
          o.updatedAt = now;
        }
      }

      renderOrders();
    }

    function setAutoRefresh(seconds) {
      if (autoTimer) { clearInterval(autoTimer); autoTimer = null; }
      if (seconds > 0) {
        autoTimer = setInterval(autoProgressTick, seconds*1000);
      }
    }

    /***********************\n     * Events              *
     ***********************/
    document.getElementById('addDemoBtn').addEventListener('click', () => {
      orders.unshift(demoOrder());
      renderOrders();
    });

    document.getElementById('seedBtn').addEventListener('click', () => {
      for (let i=0; i<5; i++) orders.unshift(demoOrder());
      renderOrders();
    });

    document.getElementById('autoRefresh').addEventListener('change', (e) => {
      const secs = parseInt(e.target.value, 10);
      setAutoRefresh(secs);
    });

    document.getElementById('refreshNow').addEventListener('click', autoProgressTick);
    document.getElementById('assistantRefresh').addEventListener('click', renderAssistant);
    document.getElementById('filterStatus').addEventListener('change', renderOrders);

    // Live clock
    setInterval(()=>{ els.clock.textContent = new Date().toLocaleTimeString(); }, 1000);

    /***********************\n     * Boot                *
     ***********************/
    // Seed some initial orders
    for (let i=0; i<6; i++) {
      const o = demoOrder();
      // Stagger creation times into the past for variety
      o.createdAt -= Math.floor(Math.random()*25)*60000; // up to ~25m ago
      if (Math.random() < 0.4) { o.status = STATUS.IN_PROGRESS; }
      orders.push(o);
    }
    renderOrders();
  </script>
</body>
</html>
